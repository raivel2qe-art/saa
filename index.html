<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glow Focus System - Cloud</title>
    <!-- Supabase JS Client Module -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- Base Reset --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            margin: 0;
            padding: 0;
            font-family: 'Inter', 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }



        /* --- Custom Cursor Aura --- */
        #cursor-aura {
            position: fixed;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 0, 0, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        /* --- Energy Pulse --- */
        .energy-pulse {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border: 2px solid rgba(255, 0, 0, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: pulseWave 6s infinite ease-out;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes pulseWave {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }

            100% {
                width: 200vw;
                height: 200vw;
                opacity: 0;
            }
        }

        /* --- Login Card Styling --- */
        #login-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, #1a0000 0%, #000 100%);
            position: relative;
            z-index: 2;
        }

        /* --- Dynamic Background --- */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .login-card {
            background: rgba(5, 0, 0, 0.8);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            width: 380px;
            padding: 45px 35px;
            border-radius: 28px;
            position: relative;
            z-index: 10;
            animation: cardAppear 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            opacity: 0;
            transform: translateY(30px) rotateX(0deg) rotateY(0deg);
            transform-style: preserve-3d;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.1);
            overflow: hidden;
            /* For neon flow */
        }

        @keyframes cardAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Neon Flow Border --- */
        .login-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent,
                    transparent,
                    transparent,
                    #ff0000);
            animation: rotateNeon 4s linear infinite;
            z-index: -1;
        }

        .login-card::after {
            content: '';
            position: absolute;
            inset: 2px;
            background: rgba(5, 0, 0, 0.9);
            border-radius: 26px;
            z-index: -1;
        }

        @keyframes rotateNeon {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .image-frame {
            width: 100%;
            height: 180px;
            margin: 0 auto 25px auto;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
            overflow: hidden;
            background-color: #000;
            position: relative;
        }

        .image-frame::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: lightSweep 4s infinite linear;
        }

        @keyframes lightSweep {
            0% {
                transform: translate(-100%, -100%) rotate(45deg);
            }

            100% {
                transform: translate(100%, 100%) rotate(45deg);
            }
        }

        .image-frame img {
            width: 100%;
            height: 100%;
            object-fit: fill;
            display: block;
        }

        .limit-label {
            color: #8b0000;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
            display: block;
        }

        h2 {
            background: linear-gradient(to right, #fff 20%, #ff0000 40%, #ff0000 60%, #fff 80%);
            background-size: 200% auto;
            color: #000;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 3s linear infinite;
            font-size: 34px;
            margin: 0 0 30px 0;
            font-weight: 900;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        @keyframes shine {
            to {
                background-position: 200% center;
            }
        }

        input {
            width: 100%;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 0, 0, 0.2);
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 25px;
            color: #fff;
            box-sizing: border-box;
            outline: none;
            font-size: 15px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateZ(20px);
            /* 3D depth */
        }

        input:focus {
            border-color: #fff;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(45deg, #cc0000, var(--neon-red));
            color: #fff;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            box-shadow: 0 4px 20px rgba(255, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .login-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 40px rgba(255, 0, 0, 0.8);
            background: #fff;
            color: #000;
            text-shadow: none;
        }

        .footer {
            color: #666;
            font-size: 11px;
            margin-top: 25px;
        }

        .footer span {
            color: #8b0000;
            font-weight: bold;
        }

        /* --- Dashboard Styling --- */
        :root {
            --red: #ff0000;
            --dark: #050000;
            --text: #ffffff;
        }

        #main-dashboard {
            display: none;
            width: 100vw;
            height: 100vh;
            background: #000;
            color: var(--text);
            flex-direction: row;
        }



        .sidebar {
            width: 280px;
            height: 100vh;
            background: rgba(1, 0, 0, 0.9);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-right: 1px solid rgba(255, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            padding: 40px 20px;
            z-index: 100;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
        }

        /* --- System Status Terminal --- */
        .system-status {
            position: absolute;
            bottom: 60px;
            left: 20px;
            right: 20px;
            height: 100px;
            background: rgba(255, 0, 0, 0.05);
            border: 1px solid rgba(255, 0, 0, 0.1);
            border-radius: 12px;
            padding: 10px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 9px;
            color: var(--red);
            overflow: hidden;
            pointer-events: none;
        }

        .status-line {
            white-space: nowrap;
            animation: scrollStatus 10s linear infinite;
        }

        @keyframes scrollStatus {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(-100%);
            }
        }

        .sidebar::before {
            content: 'SYSTEM_ACTIVE';
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-size: 10px;
            color: var(--red);
            font-family: monospace;
            letter-spacing: 2px;
            opacity: 0.5;
            animation: flicker 2s infinite;
        }

        @keyframes flicker {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 0.2;
            }

            52% {
                opacity: 0.8;
            }
        }

        .logo-frame-dash {
            width: 100%;
            height: 140px;
            border: 1px solid rgba(255, 0, 0, 0.4);
            border-radius: 24px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.2);
            margin-bottom: 50px;
            overflow: hidden;
            background: #000;
            position: relative;
        }

        .logo-frame-dash::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 0, 0, 0.1), transparent);
            transform: rotate(45deg);
            animation: lightSweep 4s infinite linear;
        }

        .logo-frame-dash img {
            width: 100%;
            height: 100%;
            object-fit: fill;
        }

        .nav-link {
            padding: 18px 22px;
            margin-bottom: 12px;
            border-radius: 16px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            border: 1px solid transparent;
            letter-spacing: 1px;
        }

        .nav-link:hover {
            background: rgba(255, 0, 0, 0.08);
            color: #fff;
            transform: translateX(10px);
            border-color: rgba(255, 0, 0, 0.3);
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .nav-link.active {
            color: #fff;
            background: rgba(255, 0, 0, 0.1);
            border-left: 3px solid var(--red);
        }


        /* --- Holographic & HUD Overlays --- */
        .system-overlay-container {
            position: fixed;
            inset: 0;
            z-index: 9999;
            pointer-events: none !important;
            user-select: none;
            overflow: hidden;
        }

        #holographic-overlay,
        #hud-overlay,
        #noise-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none !important;
        }

        #holographic-overlay {
            background-image:
                radial-gradient(circle at 50% 50%, transparent 40%, rgba(255, 0, 0, 0.05) 100%),
                linear-gradient(rgba(255, 0, 0, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 0, 0, 0.02) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
            opacity: 0.4;
        }

        #hud-overlay {
            background:
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }

        #noise-overlay {
            background-image: url('https://grainy-gradients.vercel.app/noise.svg');
            opacity: 0.05;
            filter: contrast(150%) brightness(100%);
        }

        .holo-ring {
            position: absolute;
            border: 1px solid rgba(255, 0, 0, 0.2);
            border-radius: 50%;
            pointer-events: none;
            animation: pulseHolo 8s infinite ease-in-out;
            z-index: 6;
            will-change: transform;
            /* GPU Optimization */
        }

        @keyframes pulseHolo {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.2;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.4;
            }
        }

        .main-content {
            flex: 1;
            padding: 60px;
            overflow-y: auto;
            background: #000;
            position: relative;
            z-index: 10;
            scroll-behavior: smooth;
            pointer-events: auto !important;
            will-change: transform, opacity;
        }

        .tab-pane {
            animation: tabGlide 0.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        }

        @keyframes tabGlide {
            0% {
                opacity: 0;
                transform: scale(0.98) translateY(10px);
                filter: blur(10px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
                filter: blur(0);
            }
        }

        .glitch-flash {
            animation: glitchFlash 0.3s ease-out;
        }

        @keyframes glitchFlash {
            0% {
                filter: hue-rotate(90deg) brightness(3);
            }

            50% {
                filter: hue-rotate(-90deg) brightness(2) contrast(2);
            }

            100% {
                filter: hue-rotate(0deg) brightness(1);
            }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #222;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }

        .header h1 {
            margin: 0;
            font-size: 40px;
            text-transform: uppercase;
            letter-spacing: 4px;
            font-weight: 900;
            background: linear-gradient(to right, #fff, #666);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            perspective: 1000px;
        }

        .folder-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 32px;
            padding: 40px 25px;
            text-align: center;
            cursor: pointer;
            position: relative;
            backdrop-filter: blur(15px);
            transition: all 0.4s ease;
            overflow: hidden;
            z-index: 20;
        }


        .folder-card:hover {
            background: rgba(255, 0, 0, 0.05);
            border-color: rgba(255, 0, 0, 0.8);
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.2);
        }

        .card-icon {
            font-size: 64px;
            margin-bottom: 25px;
            display: block;
            filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.3));
        }

        .folder-card h3 {
            font-size: 20px;
            font-weight: 900;
            letter-spacing: 1px;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .kill-vid {
            width: 100%;
            height: 160px;
            border-radius: 15px;
            object-fit: cover;
            margin-bottom: 15px;
            border: 2px solid #222;
        }

        .btn {
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 5px;
        }

        .action-btn {
            background: #fff;
            color: #000;
            padding: 15px 40px;
            border-radius: 50px;
            width: auto;
            font-weight: 900;
        }

        .action-btn:hover {
            background: var(--red);
            color: #fff;
            transform: scale(1.1);
        }

        .btn-dl {
            background: #111;
            color: #fff;
            border: 1px solid #333;
        }

        .btn-dl:hover {
            background: #fff;
            color: #000;
        }

        .btn-link {
            background: var(--red);
            color: #fff;
            margin-top: 10px;
        }

        .btn-del {
            color: var(--red);
            background: transparent;
            font-size: 12px;
            margin-top: 10px;
        }

        .back-link {
            color: var(--red);
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            display: block;
        }

        .hidden {
            display: none !important;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            font-size: 24px;
        }
    </style>
</head>

<body>
    <div id="cursor-aura"></div>
    <canvas id="bg-canvas"></canvas>
    <div id="loading" class="loading-overlay">Uploading...</div>

    <!-- Multi-Layer Visual Overlays -->
    <div class="system-overlay-container">
        <div id="holographic-overlay"></div>
        <div id="hud-overlay"></div>
        <div id="noise-overlay"></div>
    </div>

    <div id="login-container">
        <div class="login-card">
            <div class="image-frame">
                <img src="dmg.logo.png" alt="logo">
            </div>
            <span class="limit-label">Limit Extremely</span>
            <h2>Login</h2>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button class="login-btn" onclick="checkLogin()">Login</button>
            <div class="footer">
                Jika tidak punya akun beli di <span>@ceosung</span>
            </div>
        </div>
    </div>

    <div id="main-dashboard">
        <aside class="sidebar">
            <div class="logo-frame-dash">
                <img src="dmg.1logo.png" alt="Logo">
            </div>

            <nav class="nav">
                <div class="nav-link active" onclick="switchTab('gta')">üéÆ GTA V SYSTEM</div>
                <div class="nav-link" onclick="switchTab('photos')">üñºÔ∏è BEST PHOTOS</div>
                <div class="nav-link" onclick="switchTab('scripts')">üìú SCRIPTS HUB</div>
                <div class="nav-link" onclick="switchTab('settings')" id="nav-settings">
                    <span>‚öôÔ∏è</span> Settings
                </div>
            </nav>

            <div class="system-status" id="system-ticker">
                <div class="status-line">>> INITIALIZING_STABLE_ULTRON...</div>
                <div class="status-line">>> SYNCING_HOLOGRAPHIC_GRIDS...</div>
                <div class="status-line">>> ENERGY_FIELD_ACTIVE...</div>
                <div class="status-line">>> SYSTEM_STABILITY_100%</div>
            </div>
        </aside>

        <main class="main-content">
            <div id="tab-gta" class="tab-pane">
                <div id="view-folders">
                    <div class="header">
                        <h1>GTA V Directory</h1>
                    </div>
                    <div class="grid">
                        <div class="folder-card" onclick="openFolder('SOUNDS')"><span class="card-icon">üîä</span>
                            <h3>SOUNDS</h3>
                        </div>
                        <div class="folder-card" onclick="openFolder('GRAPHICS')"><span class="card-icon">üé¨</span>
                            <h3>GRAPHICS</h3>
                        </div>
                        <div class="folder-card" onclick="openFolder('KILLEFFECTS')"><span class="card-icon">üíÄ</span>
                            <h3>KILL EFFECTS</h3>
                        </div>
                        <div class="folder-card" onclick="openFolder('RESHADE')"><span class="card-icon">üé®</span>
                            <h3>RESHADE</h3>
                        </div>
                    </div>
                </div>
                <div id="view-files" class="hidden">
                    <span class="back-link" onclick="closeFolder()">‚Üê RETURN TO DIRECTORY</span>
                    <div class="header">
                        <h1 id="folderTitle">Folder</h1>
                        <button class="action-btn" onclick="triggerUpload()">+ UPLOAD NEW</button>
                    </div>
                    <div id="fileGrid" class="grid"></div>
                </div>
            </div>

            <div id="tab-photos" class="hidden tab-pane">
                <div class="header">
                    <h1>Best Photos</h1><button class="action-btn"
                        onclick="document.getElementById('inpPhoto').click()">+ ADD PHOTO</button>
                </div>
                <div id="photoGrid" class="grid"></div>
            </div>

            <div id="tab-scripts" class="hidden tab-pane">
                <div class="header">
                    <h1>Scripts Hub</h1>
                </div>
                <div class="grid">
                    <div class="folder-card">
                        <h3>Active</h3>
                    </div>
                </div>
            </div>
            <div id="tab-settings" class="hidden tab-pane">
                <div class="header">
                    <h1>Settings</h1>
                </div><button class="action-btn" style="background:red; color:white;" onclick="hardReset()">üóëÔ∏è RESET
                    ALL DATA</button>
            </div>
        </main>
    </div>

    <input type="file" id="inpFile" class="hidden" onchange="uploadFile()">
    <input type="file" id="inpMedia" class="hidden" accept="video/*,image/*" onchange="uploadMedia()">
    <input type="file" id="inpLink" class="hidden" onchange="linkFile()">
    <input type="file" id="inpPhoto" class="hidden" accept="image/*" onchange="uploadPhoto()">

    <script>
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        const mouse = { x: null, y: null };
        const holoOverlay = document.getElementById('holographic-overlay');

        function createHoloRings() {
            if (!holoOverlay) return;
            for (let i = 0; i < 5; i++) {
                const ring = document.createElement('div');
                ring.className = 'holo-ring';
                ring.style.width = (i + 1) * 150 + 'px';
                ring.style.height = (i + 1) * 150 + 'px';
                ring.style.animationDelay = i * 0.5 + 's';
                holoOverlay.appendChild(ring);
            }
        }
        createHoloRings();

        const card = document.querySelector('.login-card');
        const aura = document.getElementById('cursor-aura');

        let particles = [];
        // let mouse = { x: null, y: null }; // This line is now redundant as mouse is declared above

        function initBackground() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            for (let i = 0; i < 120; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2 + 1,
                    speedX: (Math.random() - 0.5) * 0.4,
                    speedY: (Math.random() - 0.5) * 0.4,
                    opacity: Math.random() * 0.5 + 0.1
                });
            }
        }


        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const isDash = document.getElementById('main-dashboard').style.display === 'flex';

            particles.forEach(p => {
                // Update movement
                p.x += p.speedX;
                p.y += p.speedY;

                if (p.x > canvas.width || p.x < 0) p.speedX *= -1;
                if (p.y > canvas.height || p.y < 0) p.speedY *= -1;

                // Energy Pulse for Dashboard
                if (isDash && mouse.x) {
                    const dx = mouse.x - p.x;
                    const dy = mouse.y - p.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 250) {
                        p.opacity = 0.8;
                        p.x += dx * 0.002;
                        p.y += dy * 0.002;
                    } else {
                        p.opacity = p.origOpacity || 0.3;
                    }
                } else if (!isDash && mouse.x) {
                    const dx = p.x - mouse.x;
                    const dy = p.y - mouse.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 150) {
                        p.x += dx / 20;
                        p.y += dy / 20;
                    }
                }

                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 0, 0, ${p.opacity})`;
                ctx.fill();
            });
            requestAnimationFrame(animate);
        }

        function updateTicker() {
            const ticker = document.getElementById('system-ticker');
            if (!ticker) return;
            const logs = [">> CORE_STABLE_ULTRON...", ">> SYNCING...", ">> ENERGY_SHIELD_ACTIVE...", ">> NO_PHYSICS_MODE_ENABLED..."];
            setInterval(() => {
                if (document.getElementById('main-dashboard').style.display === 'flex') {
                    const line = document.createElement('div');
                    line.className = 'status-line';
                    line.innerText = logs[Math.floor(Math.random() * logs.length)];
                    ticker.appendChild(line);
                    if (ticker.childNodes.length > 20) ticker.removeChild(ticker.firstChild);
                }
            }, 2500);
        }
        updateTicker();

        window.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;

            // Cursor Aura
            aura.style.left = e.clientX + 'px';
            aura.style.top = e.clientY + 'px';

            // 3D Card Tilt
            if (card && document.getElementById('login-container').style.display !== 'none') {
                const rect = card.getBoundingClientRect();
                const cardX = rect.left + rect.width / 2;
                const cardY = rect.top + rect.height / 2;
                const rotateY = (e.clientX - cardX) / 15;
                const rotateX = (cardY - e.clientY) / 15;
                card.style.transform = `translateY(0) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            }

            // Holographic Parallax
            if (holoOverlay && document.getElementById('main-dashboard').style.display === 'flex') {
                const rings = document.querySelectorAll('.holo-ring');
                rings.forEach((ring, i) => {
                    const factor = (i + 1) * 0.05;
                    ring.style.left = e.clientX + 'px';
                    ring.style.top = e.clientY + 'px';
                    ring.style.transform = `translate(-50%, -50%) translate3d(${(e.clientX - window.innerWidth / 2) * factor}px, ${(e.clientY - window.innerHeight / 2) * factor}px, 0)`;
                });
            }

            // Dashboard Interaction
            if (document.getElementById('main-dashboard').style.display === 'flex') {
                const cards = document.querySelectorAll('.folder-card');
                cards.forEach(c => {
                    const rect = c.getBoundingClientRect();
                    const dist = Math.sqrt(Math.pow(e.clientX - (rect.left + rect.width / 2), 2) + Math.pow(e.clientY - (rect.top + rect.height / 2), 2));
                    if (dist < 300) {
                        c.style.setProperty('--mx', `${(e.clientX - rect.left) / rect.width * 100}%`);
                        c.style.setProperty('--my', `${(e.clientY - rect.top) / rect.height * 100}%`);
                    }
                });
            }
        });

        window.addEventListener('mouseleave', () => {
            mouse.x = null;
            mouse.y = null;
            if (card) card.style.transform = `translateY(0) rotateX(0deg) rotateY(0deg)`;
        });

        window.addEventListener('resize', initBackground);
        initBackground();
        animate();

        // Supabase Setup
        const SUPABASE_URL = 'https://vuwdgvsjavgdcksefgst.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1d2RndnNqYXZnZGNrc2VmZ3N0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODI1NTU3NSwiZXhwIjoyMDgzODMxNTc1fQ.2ZFF7rn9WPtEk0mvNpq93viC9C64CL7HAMHCJSeeLeo';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentFolder = '';
        let targetId = null;
        let currentTab = 'gta';

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        // Login Check
        function checkLogin() {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;

            if ((user === "fhad" && pass === "1234") || (user === "feasl" && pass === "1234")) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('main-dashboard').style.display = 'flex';
                if (currentTab === 'photos') loadPhotos();
            } else {
                alert("Wrong Username or Password!");
            }
        }

        function switchTab(tab) {
            const content = document.querySelector('.main-content');
            content.classList.add('glitch-flash');
            setTimeout(() => content.classList.remove('glitch-flash'), 300);

            currentTab = tab;
            ['tab-gta', 'tab-photos', 'tab-scripts', 'tab-settings'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            if (tab === 'gta') closeFolder();
            if (tab === 'photos') loadPhotos();
        }

        function openFolder(name) {
            currentFolder = name;
            document.getElementById('view-folders').classList.add('hidden');
            document.getElementById('view-files').classList.remove('hidden');
            document.getElementById('folderTitle').innerText = name;
            loadFiles();
        }

        function closeFolder() {
            document.getElementById('view-files').classList.add('hidden');
            document.getElementById('view-folders').classList.remove('hidden');
        }

        function triggerUpload() {
            if (['KILLEFFECTS', 'SOUNDS', 'GRAPHICS', 'RESHADE'].includes(currentFolder)) {
                document.getElementById('inpMedia').click();
            } else {
                document.getElementById('inpFile').click();
            }
        }

        async function uploadFile() {
            const file = document.getElementById('inpFile').files[0];
            if (!file) return;
            await saveToCloud({ type: 'file', folder: currentFolder, name: file.name, file: file });
        }

        async function uploadMedia() {
            const file = document.getElementById('inpMedia').files[0];
            if (!file) return;
            const type = file.type.startsWith('image/') ? 'photo' : (file.type.startsWith('video/') ? 'video' : 'file');
            await saveToCloud({ type: type, folder: currentFolder, name: file.name, file: file });
        }

        async function uploadPhoto() {
            const file = document.getElementById('inpPhoto').files[0];
            if (!file) return;
            const folder = currentTab === 'photos' ? 'PHOTOS' : currentFolder;
            await saveToCloud({ type: 'photo', folder: folder, name: file.name, file: file });
        }

        async function saveToCloud(obj) {
            showLoading(true);
            try {
                // 1. Upload to Storage
                // Use a strictly safe filename for storage to avoid "Invalid key" errors
                const storageFileName = `file_${Date.now()}_${Math.random().toString(36).substring(7)}`;

                const { data: uploadData, error: uploadError } = await _supabase.storage
                    .from('index')
                    .upload(storageFileName, obj.file);

                if (uploadError) throw uploadError;

                const { data: urlData } = _supabase.storage
                    .from('index')
                    .getPublicUrl(storageFileName);

                const publicUrl = urlData.publicUrl;

                // 2. Save to Database
                const { error: dbError } = await _supabase
                    .from('dashboard_data')
                    .insert({
                        type: obj.type,
                        folder: obj.folder,
                        name: obj.name, // Keep the original name for the UI
                        data_url: publicUrl,
                        storage_path: storageFileName
                    });

                if (dbError) throw dbError;

                if (obj.folder === 'PHOTOS') loadPhotos(); else loadFiles();
            } catch (err) {
                console.error("Cloud Error:", err);
                alert("Upload failed! Error: " + (err.message || err.error_description || "Unknown error") + "\n\nMake sure storage bucket 'index' and table 'dashboard_data' are both ready.");
            } finally {
                showLoading(false);
            }
        }

        async function loadFiles() {
            const grid = document.getElementById('fileGrid');
            grid.innerHTML = '<div style="color:white">Loading...</div>';

            const { data, error } = await _supabase
                .from('dashboard_data')
                .select('*')
                .eq('folder', currentFolder);

            if (error) {
                console.error(error);
                return;
            }

            grid.innerHTML = '';
            data.forEach(item => renderFile(item, grid));
        }

        function renderFile(item, grid) {
            const div = document.createElement('div');
            div.className = 'folder-card';

            // Force video layout for these folders to show the player and 'LINK MOD' buttons
            const isVideoFolder = ['SOUNDS', 'KILLEFFECTS', 'GRAPHICS', 'RESHADE'].includes(item.folder);

            if (item.type === 'video' || isVideoFolder) {
                // If it's a photo but in a video folder, we'll still show it as a photo but with the full button set
                const mediaHtml = item.type === 'video'
                    ? `<video src="${item.data_url}" class="kill-vid" autoplay loop muted 
                        onmouseover="if(['SOUNDS','KILLEFFECTS','GRAPHICS','RESHADE'].includes('${item.folder}')) this.muted=false" 
                        onmouseout="this.muted=true" playsinline></video>`
                    : `<img src="${item.data_url}" style="width:100%; height:160px; object-fit:cover; border-radius:15px; margin-bottom:15px;">`;

                div.innerHTML = `
                    ${mediaHtml}
                    <div style="font-size:12px; margin-bottom:5px; color:#aaa;">${item.name}</div>
                    <button class="btn btn-link" onclick="startLink(${item.id})">üîó LINK MOD FILE</button>
                    ${item.link_name ? `<button class="btn btn-dl" onclick="download('${item.link_data_url}', '${item.link_name}')">üì• DOWNLOAD MOD</button>` : ''}
                    <button class="btn btn-del" onclick="deleteItem(${item.id}, '${item.storage_path}')">REMOVE</button>`;
            } else {
                div.innerHTML = `<span class="card-icon">üìÑ</span><h3>${item.name}</h3>
                    <button class="btn btn-dl" onclick="download('${item.data_url}', '${item.name}')">DOWNLOAD</button>
                    <button class="btn btn-del" onclick="deleteItem(${item.id}, '${item.storage_path}')">REMOVE</button>`;
            }
            grid.appendChild(div);
        }

        async function loadPhotos() {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '<div style="color:white">Loading...</div>';

            const { data, error } = await _supabase
                .from('dashboard_data')
                .select('*')
                .eq('type', 'photo')
                .eq('folder', 'PHOTOS');

            if (error) {
                console.error(error);
                return;
            }

            grid.innerHTML = '';
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'folder-card';
                div.innerHTML = `<img src="${item.data_url}" style="width:100%; height:180px; object-fit:cover; border-radius:15px;">
                    <button class="btn btn-dl" onclick="download('${item.data_url}', '${item.name}')">SAVE</button>
                    <button class="btn btn-del" onclick="deleteItem(${item.id}, '${item.storage_path}')">DELETE</button>`;
                grid.appendChild(div);
            });
        }

        function startLink(id) { targetId = id; document.getElementById('inpLink').click(); }

        async function linkFile() {
            const file = document.getElementById('inpLink').files[0];
            if (!file) return;

            showLoading(true);
            try {
                const storageFileName = `mod_${Date.now()}_${Math.random().toString(36).substring(7)}`;

                await _supabase.storage.from('index').upload(storageFileName, file);
                const { data: urlData } = _supabase.storage.from('index').getPublicUrl(storageFileName);

                const { error } = await _supabase
                    .from('dashboard_data')
                    .update({
                        link_name: file.name,
                        link_data_url: urlData.publicUrl,
                        link_storage_path: storageFileName
                    })
                    .eq('id', targetId);

                if (error) throw error;
                loadFiles();
            } catch (err) {
                console.error(err);
                alert("Linking failed!");
            } finally {
                showLoading(false);
            }
        }

        async function deleteItem(id, storagePath) {
            if (!confirm("Are you sure?")) return;
            showLoading(true);
            try {
                // 1. Delete from Storage
                if (storagePath) {
                    await _supabase.storage.from('index').remove([storagePath]);
                }

                // 2. Delete from DB
                const { error } = await _supabase
                    .from('dashboard_data')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                if (currentTab === 'photos') loadPhotos(); else loadFiles();
            } catch (err) {
                console.error(err);
                alert("Delete failed!");
            } finally {
                showLoading(false);
            }
        }

        function download(url, name) {
            const a = document.createElement('a'); a.href = url; a.download = name; a.click();
        }

        async function hardReset() {
            if (confirm("This will Clear Cloud Data if you have permissions. Proceed?")) {
                alert("Reset logic should be handled in Supabase Dashboard for safety.");
            }
        }
    </script>
</body>

</html>